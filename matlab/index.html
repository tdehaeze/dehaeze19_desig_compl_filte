<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-08-14 mer. 10:55 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>On the Design of Complementary Filters for Control - Computation with Matlab</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Thomas Dehaeze" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="../css/readtheorg.css"/>
<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/jquery.stickytableheaders.min.js"></script>
<script src="../js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">On the Design of Complementary Filters for Control - Computation with Matlab</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc9467b8">1. Optimal Sensor Fusion for noise characteristics</a>
<ul>
<li><a href="#org0d8d47e">1.1. Architecture</a></li>
<li><a href="#org09b3f50">1.2. Noise of the sensors</a></li>
<li><a href="#orgf68a950">1.3. H-Two Synthesis</a></li>
<li><a href="#org6ea5bb4">1.4. Analysis</a></li>
</ul>
</li>
<li><a href="#org856703c">2. Robustness to sensor dynamics uncertainty</a>
<ul>
<li><a href="#orge067285">2.1. Unknown sensor dynamics dynamics</a></li>
<li><a href="#org797d2b4">2.2. Design the complementary filters in order to limit the phase and gain uncertainty of the super sensor</a></li>
<li><a href="#org0a746c2">2.3. First Basic Example with gain mismatch</a></li>
<li><a href="#org02cc414">2.4. <span class="todo TODO">TODO</span> More Complete example with model uncertainty</a></li>
</ul>
</li>
<li><a href="#orgbed1fa0">3. Complementary filters using analytical formula</a>
<ul>
<li><a href="#org422c6c7">3.1. Analytical 1st order complementary filters</a></li>
<li><a href="#org3d0912d">3.2. Second Order Complementary Filters</a></li>
<li><a href="#org00cb2d2">3.3. Third Order Complementary Filters</a></li>
</ul>
</li>
<li><a href="#orgc5f96ba">4. H-Infinity synthesis of complementary filters</a>
<ul>
<li><a href="#org7e7e575">4.1. Synthesis Architecture</a></li>
<li><a href="#orgfeb325c">4.2. Weights</a></li>
<li><a href="#org0ac21ba">4.3. H-Infinity Synthesis</a></li>
<li><a href="#orge4a1e6b">4.4. Obtained Complementary Filters</a></li>
</ul>
</li>
<li><a href="#org3621a02">5. Feedback Control Architecture to generate Complementary Filters</a>
<ul>
<li><a href="#org5a784d8">5.1. Architecture</a></li>
<li><a href="#orgf91f33d">5.2. Loop Gain Design</a></li>
<li><a href="#org43be2ba">5.3. Complementary Filters Obtained</a></li>
</ul>
</li>
<li><a href="#org7a544fc">6. Generating 3 complementary filters</a>
<ul>
<li><a href="#org0f19b25">6.1. Theory</a></li>
<li><a href="#org13b6f2b">6.2. Weights</a></li>
<li><a href="#orge8c83d6">6.3. H-Infinity Synthesis</a></li>
<li><a href="#orge642077">6.4. Obtained Complementary Filters</a></li>
</ul>
</li>
<li><a href="#orgdbb1cf1">7. Try to implement complementary filters for LIGO</a>
<ul>
<li><a href="#orgea8e940">7.1. Specifications</a></li>
<li><a href="#orge38e08c">7.2. FIR Filter</a></li>
<li><a href="#org48a87c8">7.3. Weights</a></li>
<li><a href="#org170666e">7.4. H-Infinity Synthesis</a></li>
<li><a href="#orgbe87287">7.5. Compare FIR and H-Infinity Filters</a></li>
</ul>
</li>
<li><a href="#org4e0fb2e">8. Analytical Formula found in the literature</a>
<ul>
<li><a href="#org33f4875">8.1. Analytical Formula</a></li>
<li><a href="#orge2e7efe">8.2. Matlab</a></li>
<li><a href="#orgf8d8c6a">8.3. Discussion</a></li>
</ul>
</li>
<li><a href="#org665e091">9. Comparison of the different methods of synthesis</a></li>
</ul>
</div>
</div>

<p>
In this document, the design of complementary filters is studied.
</p>

<p>
One use of complementary filter is described below:
</p>
<blockquote>
<p>
The basic idea of a complementary filter involves taking two or more sensors, filtering out unreliable frequencies for each sensor, and combining the filtered outputs to get a better estimate throughout the entire bandwidth of the system.
To achieve this, the sensors included in the filter should complement one another by performing better over specific parts of the system bandwidth.
</p>
</blockquote>

<ul class="org-ul">
<li>in section <a href="#orgbd8d4b8">1</a>, the optimal design of the complementary filters in order to obtain the lowest resulting "super sensor" noise is studied</li>
</ul>

<p>
When blending two sensors using complementary filters with unknown dynamics, phase lag may be introduced that renders the close-loop system unstable.
</p>
<ul class="org-ul">
<li>in section <a href="#org82bdd50">2</a>, the blending robustness to sensor dynamic uncertainty is studied.</li>
</ul>

<p>
Then, three design methods for generating two complementary filters are proposed:
</p>
<ul class="org-ul">
<li>in section <a href="#org825a820">3</a>, analytical formulas are proposed</li>
<li>in section <a href="#org4bdbf5b">4</a>, the \(\mathcal{H}_\infty\) synthesis is used</li>
<li>in section <a href="#org7c53eb3">5</a>, the classical feedback architecture is used</li>
<li>in section <a href="#orgc3dce28">6</a>, a method using the \(\mathcal{H}_\infty\) synthesis is proposed to shape three of more complementary filters</li>
</ul>

<p>
Finally:
</p>
<ul class="org-ul">
<li>in section <a href="#orgb64b50c">7</a>, some design methods are used and compared with FIR complementary filters used for LIGO</li>
<li>in section <a href="#orgc408884">8</a>, analytical formulas found in the literature are listed</li>
<li>in section <a href="#org31b6972">9</a>, we discuss the findings</li>
</ul>

<div id="outline-container-orgc9467b8" class="outline-2">
<h2 id="orgc9467b8"><span class="section-number-2">1</span> Optimal Sensor Fusion for noise characteristics</h2>
<div class="outline-text-2" id="text-1">
<p>
<a id="orgbd8d4b8"></a>
</p>
<p>
The idea is to combine sensors that works in different frequency range using complementary filters.
</p>

<p>
Doing so, one "super sensor" is obtained that can have better noise characteristics than the individual sensors over a large frequency range.
</p>

<p>
The complementary filters have to be designed in order to minimize the effect noise of each sensor on the super sensor noise.
</p>
<div class="note">
<p>
All the files (data and Matlab scripts) are accessible <a href="data/optimal_comp_filters.zip">here</a>.
</p>

</div>
</div>

<div id="outline-container-org0d8d47e" class="outline-3">
<h3 id="org0d8d47e"><span class="section-number-3">1.1</span> Architecture</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Let's consider the sensor fusion architecture shown on figure <a href="#orga15cbb7">1</a> where two sensors 1 and 2 are measuring the same quantity \(x\) with different noise characteristics determined by \(W_1\) and \(W_2\).
</p>

<p>
\(n_1\) and \(n_2\) are white noise (constant power spectral density over all frequencies).
</p>


<div id="orga15cbb7" class="figure">
<p><img src="figs/fusion_two_noisy_sensors_with_dyn.png" alt="fusion_two_noisy_sensors_with_dyn.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Fusion of two sensors</p>
</div>

<p>
We consider that the two sensor dynamics \(G_1\) and \(G_2\) are ideal (\(G_1 = G_2 = 1\)). We obtain the architecture of figure <a href="#org3eeb0bf">2</a>.
</p>


<div id="org3eeb0bf" class="figure">
<p><img src="figs/fusion_two_noisy_sensors.png" alt="fusion_two_noisy_sensors.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Fusion of two sensors with ideal dynamics</p>
</div>

<p>
\(H_1\) and \(H_2\) are complementary filters (\(H_1 + H_2 = 1\)). The goal is to design \(H_1\) and \(H_2\) such that the effect of the noise sources \(n_1\) and \(n_2\) has the smallest possible effect on the estimation \(\hat{x}\).
</p>

<p>
We have that the Power Spectral Density (PSD) of \(\hat{x}\) is:
\[ \Gamma_{\hat{x}} = |H_1 W_1|^2 \Gamma_{n_1} + |H_2 W_2|^2 \Gamma_{n_2} \]
</p>

<p>
And the goal is the minimize the Root Mean Square (RMS) value of \(\hat{x}\):
\[ \sigma_{\hat{x}} = \sqrt{\int_0^\infty \Gamma_{\hat{x}}(\omega) d\omega} \]
</p>

<p>
As \(n_1\) and \(n_2\) are white noise: \(\Gamma_{n_1} = \Gamma_{n_2} = 1\) and we have:
\[ \sigma_{\hat{x}} = \sqrt{\int_0^\infty |H_1 W_1|^2(\omega) + |H_2 W_2|^2(\omega) d\omega} = \left\| \begin{matrix} H_1 W_1 \\ H_2 W_2 \end{matrix} \right\|_2 \]
</p>

<p>
Thus, the goal is to design \(H_1\) and \(H_2\) such that \(H_1 + H_2 = 1\) and such that \(\left\| \begin{matrix} H_1 W_1 \\ H_2 W_2 \end{matrix} \right\|_2\) is minimized.
</p>

<p>
For that, we will use the \(\mathcal{H}_2\) Synthesis.
</p>
</div>
</div>

<div id="outline-container-org09b3f50" class="outline-3">
<h3 id="org09b3f50"><span class="section-number-3">1.2</span> Noise of the sensors</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Let's define the noise characteristics of the two sensors by choosing \(W_1\) and \(W_2\):
</p>
<ul class="org-ul">
<li>Sensor 1 characterized by \(W_1\) has low noise at low frequency (for instance a geophone)</li>
<li>Sensor 2 characterized by \(W_2\) has low noise at high frequency (for instance an accelerometer)</li>
</ul>

<div class="org-src-container">
<pre class="src src-matlab">omegac = <span class="org-highlight-numbers-number">100</span><span class="org-type">*</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span>; G0 = <span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">5</span>; Ginf = <span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span>;
W1 = <span class="org-rainbow-delimiters-depth-1">(</span>Ginf<span class="org-type">*</span>s<span class="org-type">/</span>omegac <span class="org-type">+</span> G0<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">/</span>omegac <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">4000</span><span class="org-rainbow-delimiters-depth-1">)</span>;

omegac = <span class="org-highlight-numbers-number">1</span><span class="org-type">*</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span>; G0 = <span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">3</span>; Ginf = <span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">8</span>;
W2 = <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>sqrt<span class="org-rainbow-delimiters-depth-3">(</span>Ginf<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">*</span>s<span class="org-type">/</span>omegac <span class="org-type">+</span> sqrt<span class="org-rainbow-delimiters-depth-3">(</span>G0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>omegac <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">4000</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span>;
</pre>
</div>


<div id="org27d2535" class="figure">
<p><img src="figs/nosie_characteristics_sensors.png" alt="nosie_characteristics_sensors.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Noise Characteristics of the two sensors (<a href="./figs/nosie_characteristics_sensors.png">png</a>, <a href="./figs/nosie_characteristics_sensors.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-orgf68a950" class="outline-3">
<h3 id="orgf68a950"><span class="section-number-3">1.3</span> H-Two Synthesis</h3>
<div class="outline-text-3" id="text-1-3">
<p>
We use the generalized plant architecture shown on figure <a href="#orga404c84">4</a>.
</p>


<div id="orga404c84" class="figure">
<p><img src="figs/h_infinity_optimal_comp_filters.png" alt="h_infinity_optimal_comp_filters.png" />
</p>
<p><span class="figure-number">Figure 4: </span>\(\mathcal{H}_2\) Synthesis - Generalized plant used for the optimal generation of complementary filters</p>
</div>

<p>
The transfer function from \([n_1, n_2]\) to \(\hat{x}\) is:
\[ \begin{bmatrix} W_1 H_1 \\ W_2 (1 - H_1) \end{bmatrix} \]
If we define \(H_2 = 1 - H_1\), we obtain:
\[ \begin{bmatrix} W_1 H_1 \\ W_2 H_2 \end{bmatrix} \]
</p>

<p>
Thus, if we minimize the \(\mathcal{H}_2\) norm of this transfer function, we minimize the RMS value of \(\hat{x}\).
</p>

<p>
We define the generalized plant \(P\) on matlab as shown on figure <a href="#orga404c84">4</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">P = <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-highlight-numbers-number">0</span>   W2  <span class="org-highlight-numbers-number">1</span>;
     W1 <span class="org-type">-</span>W2  <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">]</span>;
</pre>
</div>

<p>
And we do the \(\mathcal{H}_2\) synthesis using the <code>h2syn</code> command.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span class="org-rainbow-delimiters-depth-1">[</span>H1, <span class="org-type">~</span>, gamma<span class="org-rainbow-delimiters-depth-1">]</span> = h2syn<span class="org-rainbow-delimiters-depth-1">(</span>P, <span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<p>
What is minimized is <code>norm([W1*H1,W2*H2], 2)</code>.
</p>

<p>
Finally, we define \(H_2 = 1 - H_1\).
</p>
<div class="org-src-container">
<pre class="src src-matlab">H2 = <span class="org-highlight-numbers-number">1</span> <span class="org-type">-</span> H1;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ea5bb4" class="outline-3">
<h3 id="org6ea5bb4"><span class="section-number-3">1.4</span> Analysis</h3>
<div class="outline-text-3" id="text-1-4">
<p>
The complementary filters obtained are shown on figure <a href="#orgb171e46">5</a>. The PSD of the <a href="#org9663c1d">6</a>.
Finally, the RMS value of \(\hat{x}\) is shown on table <a href="#org364f617">1</a>.
The optimal sensor fusion has permitted to reduced the RMS value of the estimation error by a factor 8 compare to when using only one sensor.
</p>


<div id="orgb171e46" class="figure">
<p><img src="figs/htwo_comp_filters.png" alt="htwo_comp_filters.png" />
</p>
<p><span class="figure-number">Figure 5: </span>Obtained complementary filters using the \(\mathcal{H}_2\) Synthesis (<a href="./figs/htwo_comp_filters.png">png</a>, <a href="./figs/htwo_comp_filters.pdf">pdf</a>)</p>
</div>


<div id="org9663c1d" class="figure">
<p><img src="figs/psd_sensors_htwo_synthesis.png" alt="psd_sensors_htwo_synthesis.png" />
</p>
<p><span class="figure-number">Figure 6: </span>Power Spectral Density of the estimated \(\hat{x}\) using the two sensors alone and using the optimally fused signal (<a href="./figs/psd_sensors_htwo_synthesis.png">png</a>, <a href="./figs/psd_sensors_htwo_synthesis.pdf">pdf</a>)</p>
</div>

<table id="org364f617" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> RMS value of the estimation error when using the sensor individually and when using the two sensor merged using the optimal complementary filters</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-right">rms value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Sensor 1</td>
<td class="org-right">1.1e-02</td>
</tr>

<tr>
<td class="org-left">Sensor 2</td>
<td class="org-right">1.3e-03</td>
</tr>

<tr>
<td class="org-left">Optimal Sensor Fusion</td>
<td class="org-right">1.5e-04</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org856703c" class="outline-2">
<h2 id="org856703c"><span class="section-number-2">2</span> Robustness to sensor dynamics uncertainty</h2>
<div class="outline-text-2" id="text-2">
<p>
<a id="org82bdd50"></a>
</p>
<p>
Let's first consider ideal sensors where \(G_1 = 1\) and \(G_2 = 1\) (figure <a href="#org6f838a2">7</a>).
</p>


<div id="org6f838a2" class="figure">
<p><img src="figs/fusion_two_noisy_sensors_with_dyn_bis.png" alt="fusion_two_noisy_sensors_with_dyn_bis.png" />
</p>
<p><span class="figure-number">Figure 7: </span>Fusion of two sensors</p>
</div>

<p>
We then have:
</p>
\begin{align*}
  \hat{x} &= (x + n_1) H_1 + (x + n_2) H_2 \\
          &= x + n_1 H_1 + n_2 H_2
\end{align*}

<p>
So the estimation error is
\[ \delta_x = \hat{x} - x = n_1 H_1 + n_2 H_2 \]
</p>

<p>
And we see that the complementary filters are only shaping the noise and that they do not impact the transfer function from \(x\) to \(\hat{x}\) that is in the feedback path.
</p>
<div class="note">
<p>
All the files (data and Matlab scripts) are accessible <a href="data/comp_filter_robustness.zip">here</a>.
</p>

</div>
</div>

<div id="outline-container-orge067285" class="outline-3">
<h3 id="orge067285"><span class="section-number-3">2.1</span> Unknown sensor dynamics dynamics</h3>
<div class="outline-text-3" id="text-2-1">
<p>
In practical systems, the sensor dynamics has always some level of uncertainty.
Let's represent that with multiplicative input uncertainty as shown on figure <a href="#org5b176c8">8</a>.
</p>


<div id="org5b176c8" class="figure">
<p><img src="figs/fusion_gain_mismatch.png" alt="fusion_gain_mismatch.png" />
</p>
<p><span class="figure-number">Figure 8: </span>Fusion of two sensors with input multiplicative uncertainty</p>
</div>

<p>
We have:
</p>
\begin{align*}
  \frac{\hat{x}}{x} &= (1 + W_1 \Delta_1) H_1 + (1 + W_2 \Delta_2) H_2 \\
                    &= 1 + W_1 H_1 \Delta_1 + W_2 H_2 \Delta_2
\end{align*}
<p>
With \(\Delta_i\) is any transfer function satisfying \(\| \Delta_i \|_\infty < 1\).
</p>

<p>
We see that as soon as we have some uncertainty in the sensor dynamics, we have that the complementary filters have some effect on the transfer function from \(x\) to \(\hat{x}\).
</p>

<p>
We want that the super sensor transfer function has a gain of 1 and no phase variation over all the frequencies:
\[ \frac{\hat{x}}{x} \approx 1 \]
</p>

<p>
Thus, we want that
</p>
\begin{align*}
                      & |W_1 H_1 \Delta_1 + W_2 H_2 \Delta_2| < \epsilon \quad \forall \omega,  \forall \Delta_i, \|\Delta_i\|_\infty < 1 \\
  \Longleftrightarrow & |W_1 H_1| + |W_2 H_2| < \epsilon \quad \forall \omega
\end{align*}

<p>
Which is approximately the same as requiring
\[ \left\| \begin{matrix} W_1 H_1 \\ W_2 H_2 \end{matrix} \right\|_\infty < \epsilon  \]
</p>


<p>
<b>How small should we choose \(\epsilon\)?</b>
</p>

<p>
The uncertainty set of the transfer function from \(\hat{x}\) to \(x\) is bounded in the complex plane by a circle centered on 1 and with a radius equal to \(\epsilon\) (figure <a href="#orga307d1d">9</a>).
</p>

<p>
We then have that the angle introduced by the super sensor is bounded by \(\arcsin(\epsilon)\):
\[ \angle \frac{\hat{x}}{x} \le \arcsin (\epsilon) \quad \forall \omega \]
</p>


<div id="orga307d1d" class="figure">
<p><img src="figs/uncertainty_gain_phase_variation.png" alt="uncertainty_gain_phase_variation.png" />
</p>
<p><span class="figure-number">Figure 9: </span>Maximum phase variation</p>
</div>

<p>
Thus, we choose should choose \(\epsilon\) so that the maximum phase uncertainty introduced by the sensors is of an acceptable value.
</p>
</div>
</div>

<div id="outline-container-org797d2b4" class="outline-3">
<h3 id="org797d2b4"><span class="section-number-3">2.2</span> Design the complementary filters in order to limit the phase and gain uncertainty of the super sensor</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Let's say the two sensors dynamics \(H_1\) and \(H_2\) have been identified with the associated uncertainty weights \(W_1\) and \(W_2\).
</p>

<p>
If we want to have a maximum phase introduced by the sensors of 20 degrees, we have to design \(H_1\) and \(H_2\) such that:
</p>
\begin{align*}
                      & arcsin(|H_1 W_1| + |H_2 W_2|) < 20 \text{ deg} \\
  \Longleftrightarrow & |H_1 W_1| + |H_2 W_2| < 0.34
\end{align*}

<p>
We can do that with the \(\mathcal{H}_\infty\) synthesis by setting upper bounds on the complementary filters using weights that corresponds to the sensor dynamics uncertainty.
</p>

<p>
For simplicity, let's suppose \(W_1(s) = W_2(s) = 0.1\) (\(10\%\) uncertainty in the sensor gain).
\[ |H_1 W_1| + |H_2 W_2| < 3.4 \]
</p>

<p>
Thus, by limiting the norm of the complementary filters, we can limit the maximum unwanted phase introduced by the uncertainty on the sensors dynamics.
</p>

<p>
This is of primary importance in order to ensure the stability of the feedback loop using the super sensor signal.
</p>
</div>
</div>

<div id="outline-container-org0a746c2" class="outline-3">
<h3 id="org0a746c2"><span class="section-number-3">2.3</span> First Basic Example with gain mismatch</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Let's consider two ideal sensors except one sensor has not an expected gain of one but a gain of \(0.6\).
</p>
<div class="org-src-container">
<pre class="src src-matlab">G1 = <span class="org-highlight-numbers-number">1</span>;
G2 = <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">6</span>;
</pre>
</div>

<p>
Let's design two complementary filters as shown on figure <a href="#org3578b70">10</a>.
The complementary filters shown in blue does not present a bump as the red ones but provides less sensor separation at high and low frequencies.
</p>


<div id="org3578b70" class="figure">
<p><img src="figs/comp_filters_robustness_test.png" alt="comp_filters_robustness_test.png" />
</p>
<p><span class="figure-number">Figure 10: </span>The two complementary filters designed for the robustness test (<a href="./figs/comp_filters_robustness_test.png">png</a>, <a href="./figs/comp_filters_robustness_test.pdf">pdf</a>)</p>
</div>

<p>
We then compute the bode plot of the super sensor transfer function \(H_1*G_1 + H_2*G_2\) for both complementary filters pair (figure <a href="#orga8e8134">11</a>).
</p>

<p>
We see that the blue complementary filters with a lower maximum norm permits to limit the phase lag introduced by the gain mismatch.
</p>


<div id="orga8e8134" class="figure">
<p><img src="figs/tf_super_sensor_comp.png" alt="tf_super_sensor_comp.png" />
</p>
<p><span class="figure-number">Figure 11: </span>Comparison of the obtained super sensor transfer functions (<a href="./figs/tf_super_sensor_comp.png">png</a>, <a href="./figs/tf_super_sensor_comp.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-org02cc414" class="outline-3">
<h3 id="org02cc414"><span class="section-number-3">2.4</span> <span class="todo TODO">TODO</span> More Complete example with model uncertainty</h3>
</div>
</div>
<div id="outline-container-orgbed1fa0" class="outline-2">
<h2 id="orgbed1fa0"><span class="section-number-2">3</span> Complementary filters using analytical formula</h2>
<div class="outline-text-2" id="text-3">
<p>
<a id="org825a820"></a>
</p>
<div class="note">
<p>
All the files (data and Matlab scripts) are accessible <a href="data/comp_filters_analytical.zip">here</a>.
</p>

</div>
</div>

<div id="outline-container-org422c6c7" class="outline-3">
<h3 id="org422c6c7"><span class="section-number-3">3.1</span> Analytical 1st order complementary filters</h3>
<div class="outline-text-3" id="text-3-1">
<p>
First order complementary filters are defined with following equations:
</p>
\begin{align}
  H_L(s) = \frac{1}{1 + \frac{s}{\omega_0}}\\
  H_H(s) = \frac{\frac{s}{\omega_0}}{1 + \frac{s}{\omega_0}}
\end{align}

<p>
Their bode plot is shown figure <a href="#org3fabcf8">12</a>.
</p>

<div class="org-src-container">
<pre class="src src-matlab">w0 = <span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span>; <span class="org-comment">% [rad/s]</span>

Hh1 = <span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>;
Hl1 = <span class="org-highlight-numbers-number">1</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>


<div id="org3fabcf8" class="figure">
<p><img src="figs/comp_filter_1st_order.png" alt="comp_filter_1st_order.png" />
</p>
<p><span class="figure-number">Figure 12: </span>Bode plot of first order complementary filter (<a href="./figs/comp_filter_1st_order.png">png</a>, <a href="./figs/comp_filter_1st_order.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-org3d0912d" class="outline-3">
<h3 id="org3d0912d"><span class="section-number-3">3.2</span> Second Order Complementary Filters</h3>
<div class="outline-text-3" id="text-3-2">
<p>
We here use analytical formula for the complementary filters \(H_L\) and \(H_H\).
</p>

<p>
The first two formulas that are used to generate complementary filters are:
</p>
\begin{align*}
  H_L(s) &= \frac{(1+\alpha) (\frac{s}{\omega_0})+1}{\left((\frac{s}{\omega_0})+1\right) \left((\frac{s}{\omega_0})^2 + \alpha (\frac{s}{\omega_0}) + 1\right)}\\
  H_H(s) &= \frac{(\frac{s}{\omega_0})^2 \left((\frac{s}{\omega_0})+1+\alpha\right)}{\left((\frac{s}{\omega_0})+1\right) \left((\frac{s}{\omega_0})^2 + \alpha (\frac{s}{\omega_0}) + 1\right)}
\end{align*}
<p>
where:
</p>
<ul class="org-ul">
<li>\(\omega_0\) is the blending frequency in rad/s.</li>
<li>\(\alpha\) is used to change the shape of the filters:
<ul class="org-ul">
<li>Small values for \(\alpha\) will produce high magnitude of the filters \(|H_L(j\omega)|\) and \(|H_H(j\omega)|\) near \(\omega_0\) but smaller value for \(|H_L(j\omega)|\) above \(\approx 1.5 \omega_0\) and for \(|H_H(j\omega)|\) below \(\approx 0.7 \omega_0\)</li>
<li>A large \(\alpha\) will do the opposite</li>
</ul></li>
</ul>

<p>
This is illustrated on figure <a href="#orgba78dd4">13</a>.
The slope of those filters at high and low frequencies is \(-2\) and \(2\) respectively for \(H_L\) and \(H_H\).
</p>


<div id="orgba78dd4" class="figure">
<p><img src="figs/comp_filters_param_alpha.png" alt="comp_filters_param_alpha.png" />
</p>
<p><span class="figure-number">Figure 13: </span>Effect of the parameter \(\alpha\) on the shape of the generated second order complementary filters (<a href="./figs/comp_filters_param_alpha.png">png</a>, <a href="./figs/comp_filters_param_alpha.pdf">pdf</a>)</p>
</div>

<p>
We now study the maximum norm of the filters function of the parameter \(\alpha\). As we saw that the maximum norm of the filters is important for the robust merging of filters.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span class="org-type">figure</span>;
plot<span class="org-rainbow-delimiters-depth-1">(</span>alphas, infnorms<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-type">set</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">gca</span>, <span class="org-string">'xscale', 'log'</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-string">; set</span><span class="org-string"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-string">gca, 'yscale', 'log'</span><span class="org-rainbow-delimiters-depth-1">)</span>;
xlabel<span class="org-rainbow-delimiters-depth-1">(</span>'$<span class="org-type">\</span>alpha$'<span class="org-rainbow-delimiters-depth-1">)</span>; ylabel<span class="org-rainbow-delimiters-depth-1">(</span>'$<span class="org-type">\|</span>H_1<span class="org-type">\|</span>_<span class="org-type">\</span>infty$'<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>


<div id="orge14f38c" class="figure">
<p><img src="figs/param_alpha_hinf_norm.png" alt="param_alpha_hinf_norm.png" />
</p>
<p><span class="figure-number">Figure 14: </span>Evolution of the H-Infinity norm of the complementary filters with the parameter \(\alpha\) (<a href="./figs/param_alpha_hinf_norm.png">png</a>, <a href="./figs/param_alpha_hinf_norm.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-org00cb2d2" class="outline-3">
<h3 id="org00cb2d2"><span class="section-number-3">3.3</span> Third Order Complementary Filters</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The following formula gives complementary filters with slopes of \(-3\) and \(3\):
</p>
\begin{align*}
  H_L(s) &= \frac{\left(1+(\alpha+1)(\beta+1)\right) (\frac{s}{\omega_0})^2 + (1+\alpha+\beta)(\frac{s}{\omega_0}) + 1}{\left(\frac{s}{\omega_0} + 1\right) \left( (\frac{s}{\omega_0})^2 + \alpha (\frac{s}{\omega_0}) + 1 \right) \left( (\frac{s}{\omega_0})^2 + \beta (\frac{s}{\omega_0}) + 1 \right)}\\
  H_H(s) &= \frac{(\frac{s}{\omega_0})^3 \left( (\frac{s}{\omega_0})^2 + (1+\alpha+\beta) (\frac{s}{\omega_0}) + (1+(\alpha+1)(\beta+1)) \right)}{\left(\frac{s}{\omega_0} + 1\right) \left( (\frac{s}{\omega_0})^2 + \alpha (\frac{s}{\omega_0}) + 1 \right) \left( (\frac{s}{\omega_0})^2 + \beta (\frac{s}{\omega_0}) + 1 \right)}
\end{align*}

<p>
The parameters are:
</p>
<ul class="org-ul">
<li>\(\omega_0\) is the blending frequency in rad/s</li>
<li>\(\alpha\) and \(\beta\) that are used to change the shape of the filters similarly to the parameter \(\alpha\) for the second order complementary filters</li>
</ul>

<p>
The filters are defined below and the result is shown on figure <a href="#org89f1217">15</a>.
</p>

<div class="org-src-container">
<pre class="src src-matlab">alpha = <span class="org-highlight-numbers-number">1</span>;
beta = <span class="org-highlight-numbers-number">10</span>;
w0 = <span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span><span class="org-highlight-numbers-number">14</span>;

Hh3_ana = <span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">3</span> <span class="org-type">*</span> <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span> <span class="org-type">+</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-type">+</span>alpha<span class="org-type">+</span>beta<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">+</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-type">+</span><span class="org-rainbow-delimiters-depth-3">(</span>alpha<span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-3">(</span>beta<span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0 <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">+</span>alpha<span class="org-type">*</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">+</span>beta<span class="org-type">*</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
Hl3_ana = <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-type">+</span><span class="org-rainbow-delimiters-depth-3">(</span>alpha<span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-3">(</span>beta<span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span> <span class="org-type">+</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-type">+</span>alpha<span class="org-type">+</span>beta<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-type">/</span>w0 <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">+</span>alpha<span class="org-type">*</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">+</span>beta<span class="org-type">*</span><span class="org-rainbow-delimiters-depth-3">(</span>s<span class="org-type">/</span>w0<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-type">+</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>


<div id="org89f1217" class="figure">
<p><img src="figs/complementary_filters_third_order.png" alt="complementary_filters_third_order.png" />
</p>
<p><span class="figure-number">Figure 15: </span>Third order complementary filters using the analytical formula (<a href="./figs/complementary_filters_third_order.png">png</a>, <a href="./figs/complementary_filters_third_order.pdf">pdf</a>)</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc5f96ba" class="outline-2">
<h2 id="orgc5f96ba"><span class="section-number-2">4</span> H-Infinity synthesis of complementary filters</h2>
<div class="outline-text-2" id="text-4">
<p>
<a id="org4bdbf5b"></a>
</p>
<div class="note">
<p>
All the files (data and Matlab scripts) are accessible <a href="data/h_inf_synthesis_complementary_filters.zip">here</a>.
</p>

</div>
</div>

<div id="outline-container-org7e7e575" class="outline-3">
<h3 id="org7e7e575"><span class="section-number-3">4.1</span> Synthesis Architecture</h3>
<div class="outline-text-3" id="text-4-1">
<p>
We here synthesize the complementary filters using the \(\mathcal{H}_\infty\) synthesis.
The goal is to specify upper bounds on the norms of \(H_L\) and \(H_H\) while ensuring their complementary property (\(H_L + H_H = 1\)).
</p>

<p>
In order to do so, we use the generalized plant shown on figure <a href="#orge3f5b3d">16</a> where \(w_L\) and \(w_H\) weighting transfer functions that will be used to shape \(H_L\) and \(H_H\) respectively.
</p>


<div id="orge3f5b3d" class="figure">
<p><img src="figs/sf_hinf_filters_plant_b.png" alt="sf_hinf_filters_plant_b.png" />
</p>
<p><span class="figure-number">Figure 16: </span>Generalized plant used for the \(\mathcal{H}_\infty\) synthesis of the complementary filters</p>
</div>

<p>
The \(\mathcal{H}_\infty\) synthesis applied on this generalized plant will give a transfer function \(H_L\) (figure <a href="#orge32d3fa">17</a>) such that the \(\mathcal{H}_\infty\) norm of the transfer function from \(w\) to \([z_H,\ z_L]\) is less than one:
\[ \left\| \begin{array}{c} H_L w_L \\ (1 - H_L) w_H \end{array} \right\|_\infty < 1 \]
</p>

<p>
Thus, if the above condition is verified, we can define \(H_H = 1 - H_L\) and we have that:
\[ \left\| \begin{array}{c} H_L w_L \\ H_H w_H \end{array} \right\|_\infty < 1 \]
Which is almost (with an maximum error of \(\sqrt{2}\)) equivalent to:
</p>
\begin{align*}
  |H_L| &< \frac{1}{|w_L|}, \quad \forall \omega \\
  |H_H| &< \frac{1}{|w_H|}, \quad \forall \omega
\end{align*}

<p>
We then see that \(w_L\) and \(w_H\) can be used to shape both \(H_L\) and \(H_H\) while ensuring (by definition of \(H_H = 1 - H_L\)) their complementary property.
</p>


<div id="orge32d3fa" class="figure">
<p><img src="figs/sf_hinf_filters_b.png" alt="sf_hinf_filters_b.png" />
</p>
<p><span class="figure-number">Figure 17: </span>\(\mathcal{H}_\infty\) synthesis of the complementary filters</p>
</div>
</div>
</div>

<div id="outline-container-orgfeb325c" class="outline-3">
<h3 id="orgfeb325c"><span class="section-number-3">4.2</span> Weights</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-matlab">omegab = <span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span><span class="org-highlight-numbers-number">9</span>;
wH = <span class="org-rainbow-delimiters-depth-1">(</span>omegab<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s <span class="org-type">+</span> omegab<span class="org-type">*</span>sqrt<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">5</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span>;
omegab = <span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span><span class="org-highlight-numbers-number">28</span>;
wL = <span class="org-rainbow-delimiters-depth-1">(</span>s <span class="org-type">+</span> omegab<span class="org-type">/</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">4</span>.<span class="org-highlight-numbers-number">5</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">^</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-type">/</span><span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">3</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">*</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">^</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-type">/</span><span class="org-highlight-numbers-number">3</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">+</span> omegab<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">3</span>;
</pre>
</div>


<div id="org2f46978" class="figure">
<p><img src="figs/weights_wl_wh.png" alt="weights_wl_wh.png" />
</p>
<p><span class="figure-number">Figure 18: </span>Weights on the complementary filters \(w_L\) and \(w_H\) and the associated performance weights (<a href="./figs/weights_wl_wh.png">png</a>, <a href="./figs/weights_wl_wh.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-org0ac21ba" class="outline-3">
<h3 id="org0ac21ba"><span class="section-number-3">4.3</span> H-Infinity Synthesis</h3>
<div class="outline-text-3" id="text-4-3">
<p>
We define the generalized plant \(P\) on matlab.
</p>
<div class="org-src-container">
<pre class="src src-matlab">P = <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-highlight-numbers-number">0</span>   wL;
     wH <span class="org-type">-</span>wH;
     <span class="org-highlight-numbers-number">1</span>   <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">]</span>;
</pre>
</div>

<p>
And we do the \(\mathcal{H}_\infty\) synthesis using the <code>hinfsyn</code> command.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span class="org-rainbow-delimiters-depth-1">[</span>Hl_hinf, <span class="org-type">~</span>, gamma, <span class="org-type">~</span><span class="org-rainbow-delimiters-depth-1">]</span> = hinfsyn<span class="org-rainbow-delimiters-depth-1">(</span>P, <span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">1</span>,'TOLGAM', <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">001</span>, 'METHOD', 'ric', 'DISPLAY', 'on'<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<pre class="example">
[Hl_hinf, ~, gamma, ~] = hinfsyn(P, 1, 1,'TOLGAM', 0.001, 'METHOD', 'ric', 'DISPLAY', 'on');
Test bounds:      0.0000 &lt;  gamma  &lt;=      1.7285

  gamma    hamx_eig  xinf_eig  hamy_eig   yinf_eig   nrho_xy   p/f
    1.729   4.1e+01   8.4e-12   1.8e-01    0.0e+00    0.0000    p
    0.864   3.9e+01 -5.8e-02#  1.8e-01    0.0e+00    0.0000    f
    1.296   4.0e+01   8.4e-12   1.8e-01    0.0e+00    0.0000    p
    1.080   4.0e+01   8.5e-12   1.8e-01    0.0e+00    0.0000    p
    0.972   3.9e+01 -4.2e-01#  1.8e-01    0.0e+00    0.0000    f
    1.026   4.0e+01   8.5e-12   1.8e-01    0.0e+00    0.0000    p
    0.999   3.9e+01   8.5e-12   1.8e-01    0.0e+00    0.0000    p
    0.986   3.9e+01 -1.2e+00#  1.8e-01    0.0e+00    0.0000    f
    0.993   3.9e+01 -8.2e+00#  1.8e-01    0.0e+00    0.0000    f
    0.996   3.9e+01   8.5e-12   1.8e-01    0.0e+00    0.0000    p
    0.994   3.9e+01   8.5e-12   1.8e-01    0.0e+00    0.0000    p
    0.993   3.9e+01 -3.2e+01#  1.8e-01    0.0e+00    0.0000    f

 Gamma value achieved:     0.9942
</pre>

<p>
We then define the high pass filter \(H_H = 1 - H_L\). The bode plot of both \(H_L\) and \(H_H\) is shown on figure <a href="#org3048f8d">19</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">Hh_hinf = <span class="org-highlight-numbers-number">1</span> <span class="org-type">-</span> Hl_hinf;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4a1e6b" class="outline-3">
<h3 id="orge4a1e6b"><span class="section-number-3">4.4</span> Obtained Complementary Filters</h3>
<div class="outline-text-3" id="text-4-4">
<p>
The obtained complementary filters are shown on figure <a href="#org3048f8d">19</a>.
</p>


<div id="org3048f8d" class="figure">
<p><img src="figs/hinf_filters_results.png" alt="hinf_filters_results.png" />
</p>
<p><span class="figure-number">Figure 19: </span>Obtained complementary filters using \(\mathcal{H}_\infty\) synthesis (<a href="./figs/hinf_filters_results.png">png</a>, <a href="./figs/hinf_filters_results.pdf">pdf</a>)</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org3621a02" class="outline-2">
<h2 id="org3621a02"><span class="section-number-2">5</span> Feedback Control Architecture to generate Complementary Filters</h2>
<div class="outline-text-2" id="text-5">
<p>
<a id="org7c53eb3"></a>
</p>
<p>
The idea is here to use the fact that in a classical feedback architecture, \(S + T = 1\), in order to design complementary filters.
</p>

<p>
Thus, all the tools that has been developed for classical feedback control can be used for complementary filter design.
</p>
<div class="note">
<p>
All the files (data and Matlab scripts) are accessible <a href="data/feedback_generate_comp_filters.zip">here</a>.
</p>

</div>
</div>

<div id="outline-container-org5a784d8" class="outline-3">
<h3 id="org5a784d8"><span class="section-number-3">5.1</span> Architecture</h3>
<div class="outline-text-3" id="text-5-1">

<div id="org23bd8d4" class="figure">
<p><img src="figs/complementary_filters_feedback_architecture.png" alt="complementary_filters_feedback_architecture.png" />
</p>
<p><span class="figure-number">Figure 20: </span>Architecture used to generate the complementary filters</p>
</div>

<p>
We have:
\[ y = \underbrace{\frac{L}{L + 1}}_{H_L} y_1 + \underbrace{\frac{1}{L + 1}}_{H_H} y_2 \]
with \(H_L + H_H = 1\).
</p>

<p>
The only thing to design is \(L\) such that the complementary filters are stable with the wanted shape.
</p>

<p>
A simple choice is:
\[ L = \left(\frac{\omega_c}{s}\right)^2 \frac{\frac{s}{\omega_c / \alpha} + 1}{\frac{s}{\omega_c} + \alpha} \]
</p>

<p>
Which contains two integrator and a lead. \(\omega_c\) is used to tune the crossover frequency and \(\alpha\) the trade-off "bump" around blending frequency and filtering away from blending frequency.
</p>
</div>
</div>

<div id="outline-container-orgf91f33d" class="outline-3">
<h3 id="orgf91f33d"><span class="section-number-3">5.2</span> Loop Gain Design</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Let's first define the loop gain \(L\).
</p>
<div class="org-src-container">
<pre class="src src-matlab">wc = <span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span><span class="org-highlight-numbers-number">1</span>;
alpha = <span class="org-highlight-numbers-number">2</span>;

L = <span class="org-rainbow-delimiters-depth-1">(</span>wc<span class="org-type">/</span>s<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span> <span class="org-type">*</span> <span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">/</span><span class="org-rainbow-delimiters-depth-2">(</span>wc<span class="org-type">/</span>alpha<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">/</span>wc <span class="org-type">+</span> alpha<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>


<div id="orgcb93ed6" class="figure">
<p><img src="figs/loop_gain_bode_plot.png" alt="loop_gain_bode_plot.png" />
</p>
<p><span class="figure-number">Figure 21: </span>Bode plot of the loop gain \(L\) (<a href="./figs/loop_gain_bode_plot.png">png</a>, <a href="./figs/loop_gain_bode_plot.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-org43be2ba" class="outline-3">
<h3 id="org43be2ba"><span class="section-number-3">5.3</span> Complementary Filters Obtained</h3>
<div class="outline-text-3" id="text-5-3">
<p>
We then compute the resulting low pass and high pass filters.
</p>
<div class="org-src-container">
<pre class="src src-matlab">Hl = L<span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>L <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>;
Hh = <span class="org-highlight-numbers-number">1</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>L <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>


<div id="org0940f56" class="figure">
<p><img src="figs/low_pass_high_pass_filters.png" alt="low_pass_high_pass_filters.png" />
</p>
<p><span class="figure-number">Figure 22: </span>Low pass and High pass filters \(H_L\) and \(H_H\) for different values of \(\alpha\) (<a href="./figs/low_pass_high_pass_filters.png">png</a>, <a href="./figs/low_pass_high_pass_filters.pdf">pdf</a>)</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org7a544fc" class="outline-2">
<h2 id="org7a544fc"><span class="section-number-2">6</span> Generating 3 complementary filters</h2>
<div class="outline-text-2" id="text-6">
<p>
<a id="orgc3dce28"></a>
</p>
<div class="note">
<p>
All the files (data and Matlab scripts) are accessible <a href="data/three_comp_filters.zip">here</a>.
</p>

</div>
</div>

<div id="outline-container-org0f19b25" class="outline-3">
<h3 id="org0f19b25"><span class="section-number-3">6.1</span> Theory</h3>
<div class="outline-text-3" id="text-6-1">
<p>
We want:
</p>
\begin{align*}
  & |H_1 w_1| < 1, \quad \forall\omega\\
  & |H_2 w_2| < 1, \quad \forall\omega\\
  & |H_3 w_3| < 1, \quad \forall\omega\\
  & H_1 + H_2 + H_3 = 1
\end{align*}

<p>
For that, we use the \(\mathcal{H}_\infty\) synthesis with the architecture shown on figure <a href="#org2b022e2">23</a>.
</p>


<div id="org2b022e2" class="figure">
<p><img src="figs/comp_filter_three_hinf.png" alt="comp_filter_three_hinf.png" />
</p>
<p><span class="figure-number">Figure 23: </span>Generalized architecture for generating 3 complementary filters</p>
</div>

<p>
The \(\mathcal{H}_\infty\) objective is:
</p>
\begin{align*}
  & |H_1 w_1| < 1, \quad \forall\omega\\
  & |H_2 w_2| < 1, \quad \forall\omega\\
  & |(1 - H_1 - H_2) w_3| < 1, \quad \forall\omega\\
\end{align*}

<p>
And thus if we choose \(H_3 = 1 - H_1 - H_2\) we have solved the problem.
</p>
</div>
</div>

<div id="outline-container-org13b6f2b" class="outline-3">
<h3 id="org13b6f2b"><span class="section-number-3">6.2</span> Weights</h3>
<div class="outline-text-3" id="text-6-2">
<p>
First we define the weights.
</p>
<div class="org-src-container">
<pre class="src src-matlab">w1 = <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">35</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">100</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span>;
w2 = <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">35</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>sqrt<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">100</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">10000</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span>;
w3 = <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">35</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">100</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>sqrt<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-type">+</span> s<span class="org-type">/</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-constant">pi</span><span class="org-type">/</span><span class="org-highlight-numbers-number">100</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span>;
</pre>
</div>


<div id="orgf8176c3" class="figure">
<p><img src="figs/three_weighting_functions.png" alt="three_weighting_functions.png" />
</p>
<p><span class="figure-number">Figure 24: </span>Three weighting functions used for the \(\mathcal{H}_\infty\) synthesis of the complementary filters (<a href="./figs/three_weighting_functions.png">png</a>, <a href="./figs/three_weighting_functions.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-orge8c83d6" class="outline-3">
<h3 id="orge8c83d6"><span class="section-number-3">6.3</span> H-Infinity Synthesis</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Then we create the generalized plant <code>P</code>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">P = <span class="org-rainbow-delimiters-depth-1">[</span>w3 <span class="org-type">-</span>w3 <span class="org-type">-</span>w3;
     <span class="org-highlight-numbers-number">0</span>   w2  <span class="org-highlight-numbers-number">0</span> ;
     <span class="org-highlight-numbers-number">0</span>   <span class="org-highlight-numbers-number">0</span>   w1;
     <span class="org-highlight-numbers-number">1</span>   <span class="org-highlight-numbers-number">0</span>   <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">]</span>;
</pre>
</div>

<p>
And we do the \(\mathcal{H}_\infty\) synthesis.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span class="org-rainbow-delimiters-depth-1">[</span>H, <span class="org-type">~</span>, gamma, <span class="org-type">~</span><span class="org-rainbow-delimiters-depth-1">]</span> = hinfsyn<span class="org-rainbow-delimiters-depth-1">(</span>P, <span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">2</span>,'TOLGAM', <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">001</span>, 'METHOD', 'ric', 'DISPLAY', 'on'<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<pre class="example">
[H, ~, gamma, ~] = hinfsyn(P, 1, 2,'TOLGAM', 0.001, 'METHOD', 'ric', 'DISPLAY', 'on');
Resetting value of Gamma min based on D_11, D_12, D_21 terms

Test bounds:      0.3500 &lt;  gamma  &lt;=      2.5115

  gamma    hamx_eig  xinf_eig  hamy_eig   yinf_eig   nrho_xy   p/f
    2.512   4.4e+00   2.7e-15   6.3e-02   -8.0e-09    0.0000    p
    1.431   4.3e+00 -7.5e-11   6.3e-02    0.0e+00    0.0000    p
    0.890   4.0e+00 -2.4e+01#  6.3e-02    0.0e+00    0.0000    f
    1.161   4.2e+00 -1.7e-13   6.3e-02   -8.1e-09    0.0000    p
    1.025   4.1e+00 -2.0e-01#  6.3e-02   -8.1e-09    0.0000    f
    1.093   4.2e+00 -2.0e+01#  6.3e-02    0.0e+00    0.0000    f
    1.127   4.2e+00 -1.4e+02#  6.3e-02    0.0e+00    0.0000    f
    1.144   4.2e+00 -2.2e+04#  6.3e-02   -1.9e-10    0.0000    f
    1.152   4.2e+00   3.5e-15   6.3e-02    0.0e+00    0.0000    p
    1.148   4.2e+00   8.7e-15   6.3e-02   -1.9e-10    0.0000    p
    1.146   4.2e+00   5.0e-15   6.3e-02    0.0e+00    0.0000    p
    1.145   4.2e+00   5.5e-15   6.3e-02    0.0e+00    0.0000    p
    1.144   4.2e+00   5.5e-16   6.3e-02   -8.0e-09    0.0000    p

 Gamma value achieved:     1.1442
</pre>
</div>
</div>

<div id="outline-container-orge642077" class="outline-3">
<h3 id="orge642077"><span class="section-number-3">6.4</span> Obtained Complementary Filters</h3>
<div class="outline-text-3" id="text-6-4">
<p>
The obtained filters are:
</p>
<div class="org-src-container">
<pre class="src src-matlab">H1 = tf<span class="org-rainbow-delimiters-depth-1">(</span>H<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
H2 = tf<span class="org-rainbow-delimiters-depth-1">(</span>H<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>;
H3 = <span class="org-highlight-numbers-number">1</span> <span class="org-type">-</span> H1 <span class="org-type">-</span> H2;
</pre>
</div>


<div id="org2ce9248" class="figure">
<p><img src="figs/three_complementary_filters_results.png" alt="three_complementary_filters_results.png" />
</p>
<p><span class="figure-number">Figure 25: </span>The three complementary filters obtained after \(\mathcal{H}_\infty\) synthesis (<a href="./figs/three_complementary_filters_results.png">png</a>, <a href="./figs/three_complementary_filters_results.pdf">pdf</a>)</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdbb1cf1" class="outline-2">
<h2 id="orgdbb1cf1"><span class="section-number-2">7</span> Try to implement complementary filters for LIGO</h2>
<div class="outline-text-2" id="text-7">
<p>
<a id="orgb64b50c"></a>
</p>
<p>
Let's try to design complementary filters that are corresponding to the complementary filters design for the LIGO and described in <a class='org-ref-reference' href="#hua05_low_ligo">hua05_low_ligo</a>.
</p>

<p>
The FIR complementary filters designed in <a class='org-ref-reference' href="#hua05_low_ligo">hua05_low_ligo</a> are of order 512 and their bode plot is shown on figure <a href="#orgac5dea3">26</a>.
</p>


<div id="orgac5dea3" class="figure">
<p><img src="figs/fir_ligo_comp_filters.png" alt="fir_ligo_comp_filters.png" />
</p>
<p><span class="figure-number">Figure 26: </span>Obtained complementary FIR filters</p>
</div>
<div class="note">
<p>
All the files (data and Matlab scripts) are accessible <a href="data/comp_filters_ligo.zip">here</a>.
</p>

</div>
</div>

<div id="outline-container-orgea8e940" class="outline-3">
<h3 id="orgea8e940"><span class="section-number-3">7.1</span> Specifications</h3>
<div class="outline-text-3" id="text-7-1">
<p>
The specifications for the filters are:
</p>
<ol class="org-ol">
<li>From \(0\) to \(0.008\text{ Hz}\),the magnitude of the filters transfer function should be less than or equal to \(8 \times 10^{-3}\)</li>
<li>From \(0.008\text{ Hz}\) to \(0.04\text{ Hz}\), it attenuates the input signal proportional to frequency cubed</li>
<li>Between \(0.04\text{ Hz}\) and \(0.1\text{ Hz}\), the magnitude of the transfer function should be less than 3</li>
<li>Above \(0.1\text{ Hz}\), the maximum of the magnitude of the complement filter should be as close to zero as possible. In our system, we would like to have the magnitude of the complementary filter to be less than \(0.1\). As the filters obtained in <a class='org-ref-reference' href="#hua05_low_ligo">hua05_low_ligo</a> have a magnitude of \(0.045\), we will set that as our requirement</li>
</ol>

<p>
The specifications are translated in upper bounds of the complementary filters are shown on figure <a href="#org76de2ec">27</a>.
</p>


<div id="org76de2ec" class="figure">
<p><img src="figs/ligo_specifications.png" alt="ligo_specifications.png" />
</p>
<p><span class="figure-number">Figure 27: </span>Specification for the LIGO complementary filters (<a href="./figs/ligo_specificationss.png">png</a>, <a href="./figs/ligo_specificationss.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-orge38e08c" class="outline-3">
<h3 id="orge38e08c"><span class="section-number-3">7.2</span> FIR Filter</h3>
<div class="outline-text-3" id="text-7-2">
<p>
We here try to implement the FIR complementary filter synthesis as explained in <a class='org-ref-reference' href="#hua05_low_ligo">hua05_low_ligo</a>.
For that, we use the <a href="http://cvxr.com/cvx/">CVX matlab Toolbox</a>.
</p>

<p>
We setup the CVX toolbox and use the <code>SeDuMi</code> solver.
</p>
<div class="org-src-container">
<pre class="src src-matlab">cvx_startup;
cvx_solver sedumi;
</pre>
</div>

<p>
We define the frequency vectors on which we will constrain the norm of the FIR filter.
</p>
<div class="org-src-container">
<pre class="src src-matlab">w1 = <span class="org-highlight-numbers-number">0</span><span class="org-type">:</span><span class="org-highlight-numbers-number">4</span>.<span class="org-highlight-numbers-number">06e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span><span class="org-type">:</span><span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">008</span>;
w2 = <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">008</span><span class="org-type">:</span><span class="org-highlight-numbers-number">4</span>.<span class="org-highlight-numbers-number">06e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span><span class="org-type">:</span><span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">04</span>;
w3 = <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">04</span><span class="org-type">:</span><span class="org-highlight-numbers-number">8</span>.<span class="org-highlight-numbers-number">12e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span><span class="org-type">:</span><span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">1</span>;
w4 = <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">1</span><span class="org-type">:</span><span class="org-highlight-numbers-number">8</span>.<span class="org-highlight-numbers-number">12e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">4</span><span class="org-type">:</span><span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">83</span>;
</pre>
</div>

<p>
We then define the order of the FIR filter.
</p>
<div class="org-src-container">
<pre class="src src-matlab">n = <span class="org-highlight-numbers-number">512</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-matlab">A1 = <span class="org-rainbow-delimiters-depth-1">[</span>ones<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w1<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>,  cos<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w1'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;
A2 = <span class="org-rainbow-delimiters-depth-1">[</span>ones<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w2<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>,  cos<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w2'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;
A3 = <span class="org-rainbow-delimiters-depth-1">[</span>ones<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w3<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>,  cos<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w3'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;
A4 = <span class="org-rainbow-delimiters-depth-1">[</span>ones<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w4<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>,  cos<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w4'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;

B1 = <span class="org-rainbow-delimiters-depth-1">[</span>zeros<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w1<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>, sin<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w1'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;
B2 = <span class="org-rainbow-delimiters-depth-1">[</span>zeros<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w2<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>, sin<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w2'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;
B3 = <span class="org-rainbow-delimiters-depth-1">[</span>zeros<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w3<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>, sin<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w3'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;
B4 = <span class="org-rainbow-delimiters-depth-1">[</span>zeros<span class="org-rainbow-delimiters-depth-2">(</span>length<span class="org-rainbow-delimiters-depth-3">(</span>w4<span class="org-rainbow-delimiters-depth-3">)</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span>, sin<span class="org-rainbow-delimiters-depth-2">(</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w4'<span class="org-type">.*</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-4">)</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">1</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span>;
</pre>
</div>

<p>
We run the convex optimization.
</p>
<div class="org-src-container">
<pre class="src src-matlab">cvx_begin

variable y<span class="org-rainbow-delimiters-depth-1">(</span>n<span class="org-type">+</span><span class="org-highlight-numbers-number">1</span>,<span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-comment">% t</span>
maximize<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-type">-</span>y<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-keyword">for</span> <span class="org-variable-name">i</span> = <span class="org-constant"><span class="org-highlight-numbers-number">1</span></span><span class="org-constant">:length</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-constant">w1</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">)</span></span>
    norm<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-highlight-numbers-number">0</span> A1<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-3">)</span>; <span class="org-highlight-numbers-number">0</span> B1<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-type">*</span>y<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">&lt;=</span> <span class="org-highlight-numbers-number">8e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">3</span>;
<span class="org-keyword">end</span>

<span class="org-keyword">for</span>  <span class="org-variable-name">i</span> = <span class="org-constant"><span class="org-highlight-numbers-number">1</span></span><span class="org-constant">:length</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-constant">w2</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">)</span></span>
    norm<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-highlight-numbers-number">0</span> A2<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-3">)</span>; <span class="org-highlight-numbers-number">0</span> B2<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-type">*</span>y<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">&lt;=</span> <span class="org-highlight-numbers-number">8e</span><span class="org-type">-</span><span class="org-highlight-numbers-number">3</span><span class="org-type">*</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-type">*</span>w2<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-constant">i</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">008</span><span class="org-type">*</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">3</span>;
<span class="org-keyword">end</span>

<span class="org-keyword">for</span> <span class="org-variable-name">i</span> = <span class="org-constant"><span class="org-highlight-numbers-number">1</span></span><span class="org-constant">:length</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-constant">w3</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">)</span></span>
    norm<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-highlight-numbers-number">0</span> A3<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-3">)</span>; <span class="org-highlight-numbers-number">0</span> B3<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-type">*</span>y<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">&lt;=</span> <span class="org-highlight-numbers-number">3</span>;
<span class="org-keyword">end</span>

<span class="org-keyword">for</span> <span class="org-variable-name">i</span> = <span class="org-constant"><span class="org-highlight-numbers-number">1</span></span><span class="org-constant">:length</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-constant">w4</span><span class="org-constant"><span class="org-rainbow-delimiters-depth-1">)</span></span>
    norm<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-rainbow-delimiters-depth-3">[</span><span class="org-highlight-numbers-number">1</span> <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-3">]</span>'<span class="org-type">-</span> <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-highlight-numbers-number">0</span> A4<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-4">)</span>; <span class="org-highlight-numbers-number">0</span> B4<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-constant">i</span>,<span class="org-type">:</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span><span class="org-type">*</span>y<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-type">&lt;=</span> y<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>;
<span class="org-keyword">end</span>

cvx_end

h = y<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">:</span>end<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<pre class="example">
cvx_begin
[Warning: A non-empty cvx problem already exists in this scope.
   It is being overwritten.]
[&gt; In cvxprob (line 28)
  In cvx_begin (line 41)]
variable y(n+1,1)
% t
maximize(-y(1))
for i = 1:length(w1)
    norm([0 A1(i,:); 0 B1(i,:)]*y) &lt;= 8e-3;
end
for  i = 1:length(w2)
    norm([0 A2(i,:); 0 B2(i,:)]*y) &lt;= 8e-3*(2*pi*w2(i)/(0.008*2*pi))^3;
end
for i = 1:length(w3)
    norm([0 A3(i,:); 0 B3(i,:)]*y) &lt;= 3;
end
for i = 1:length(w4)
    norm([[1 0]'- [0 A4(i,:); 0 B4(i,:)]*y]) &lt;= y(1);
end
cvx_end

Calling SeDuMi 1.34: 4291 variables, 1586 equality constraints
   For improved efficiency, SeDuMi is solving the dual problem.
------------------------------------------------------------
SeDuMi 1.34 (beta) by AdvOL, 2005-2008 and Jos F. Sturm, 1998-2003.
Alg = 2: xz-corrector, Adaptive Step-Differentiation, theta = 0.250, beta = 0.500
eqs m = 1586, order n = 3220, dim = 4292, blocks = 1073
nnz(A) = 1100727 + 0, nnz(ADA) = 1364794, nnz(L) = 683190
 it :     b*y       gap    delta  rate   t/tP*  t/tD*   feas cg cg  prec
  0 :            4.11E+02 0.000
  1 :  -2.58E+00 1.25E+02 0.000 0.3049 0.9000 0.9000   4.87  1  1  3.0E+02
  2 :  -2.36E+00 3.90E+01 0.000 0.3118 0.9000 0.9000   1.83  1  1  6.6E+01
  3 :  -1.69E+00 1.31E+01 0.000 0.3354 0.9000 0.9000   1.76  1  1  1.5E+01
  4 :  -8.60E-01 7.10E+00 0.000 0.5424 0.9000 0.9000   2.48  1  1  4.8E+00
  5 :  -4.91E-01 5.44E+00 0.000 0.7661 0.9000 0.9000   3.12  1  1  2.5E+00
  6 :  -2.96E-01 3.88E+00 0.000 0.7140 0.9000 0.9000   2.62  1  1  1.4E+00
  7 :  -1.98E-01 2.82E+00 0.000 0.7271 0.9000 0.9000   2.14  1  1  8.5E-01
  8 :  -1.39E-01 2.00E+00 0.000 0.7092 0.9000 0.9000   1.78  1  1  5.4E-01
  9 :  -9.99E-02 1.30E+00 0.000 0.6494 0.9000 0.9000   1.51  1  1  3.3E-01
 10 :  -7.57E-02 8.03E-01 0.000 0.6175 0.9000 0.9000   1.31  1  1  2.0E-01
 11 :  -5.99E-02 4.22E-01 0.000 0.5257 0.9000 0.9000   1.17  1  1  1.0E-01
 12 :  -5.28E-02 2.45E-01 0.000 0.5808 0.9000 0.9000   1.08  1  1  5.9E-02
 13 :  -4.82E-02 1.28E-01 0.000 0.5218 0.9000 0.9000   1.05  1  1  3.1E-02
 14 :  -4.56E-02 5.65E-02 0.000 0.4417 0.9045 0.9000   1.02  1  1  1.4E-02
 15 :  -4.43E-02 2.41E-02 0.000 0.4265 0.9004 0.9000   1.01  1  1  6.0E-03
 16 :  -4.37E-02 8.90E-03 0.000 0.3690 0.9070 0.9000   1.00  1  1  2.3E-03
 17 :  -4.35E-02 3.24E-03 0.000 0.3641 0.9164 0.9000   1.00  1  1  9.5E-04
 18 :  -4.34E-02 1.55E-03 0.000 0.4788 0.9086 0.9000   1.00  1  1  4.7E-04
 19 :  -4.34E-02 8.77E-04 0.000 0.5653 0.9169 0.9000   1.00  1  1  2.8E-04
 20 :  -4.34E-02 5.05E-04 0.000 0.5754 0.9034 0.9000   1.00  1  1  1.6E-04
 21 :  -4.34E-02 2.94E-04 0.000 0.5829 0.9136 0.9000   1.00  1  1  9.9E-05
 22 :  -4.34E-02 1.63E-04 0.015 0.5548 0.9000 0.0000   1.00  1  1  6.6E-05
 23 :  -4.33E-02 9.42E-05 0.000 0.5774 0.9053 0.9000   1.00  1  1  3.9E-05
 24 :  -4.33E-02 6.27E-05 0.000 0.6658 0.9148 0.9000   1.00  1  1  2.6E-05
 25 :  -4.33E-02 3.75E-05 0.000 0.5972 0.9187 0.9000   1.00  1  1  1.6E-05
 26 :  -4.33E-02 1.89E-05 0.000 0.5041 0.9117 0.9000   1.00  1  1  8.6E-06
 27 :  -4.33E-02 9.72E-06 0.000 0.5149 0.9050 0.9000   1.00  1  1  4.5E-06
 28 :  -4.33E-02 2.94E-06 0.000 0.3021 0.9194 0.9000   1.00  1  1  1.5E-06
 29 :  -4.33E-02 9.73E-07 0.000 0.3312 0.9189 0.9000   1.00  2  2  5.3E-07
 30 :  -4.33E-02 2.82E-07 0.000 0.2895 0.9063 0.9000   1.00  2  2  1.6E-07
 31 :  -4.33E-02 8.05E-08 0.000 0.2859 0.9049 0.9000   1.00  2  2  4.7E-08
 32 :  -4.33E-02 1.43E-08 0.000 0.1772 0.9059 0.9000   1.00  2  2  8.8E-09

iter seconds digits       c*x               b*y
 32     46.6   6.8 -4.3334083581e-02 -4.3334090214e-02
|Ax-b| =   3.7e-09, [Ay-c]_+ =   1.1E-10, |x|=  1.0e+00, |y|=  2.6e+00

Detailed timing (sec)
   Pre          IPM          Post
3.281E+00    4.295E+01    1.497E-02
Max-norms: ||b||=1, ||c|| = 3,
Cholesky |add|=0, |skip| = 0, ||L.L|| = 4.26267.
------------------------------------------------------------
Status: Solved
Optimal value (cvx_optval): -0.0433341
h = y(2:end);
</pre>

<p>
Finally, we compute the filter response over the frequency vector defined and the result is shown on figure <a href="#orga8cfb90">28</a> which is very close to the filters obtain in <a class='org-ref-reference' href="#hua05_low_ligo">hua05_low_ligo</a> and shown on figure <a href="#orgac5dea3">26</a>.
</p>

<div class="org-src-container">
<pre class="src src-matlab">w = <span class="org-rainbow-delimiters-depth-1">[</span>w1 w2 w3 w4<span class="org-rainbow-delimiters-depth-1">]</span>;
H = <span class="org-rainbow-delimiters-depth-1">[</span>exp<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">-</span><span class="org-constant">j</span><span class="org-type">*</span>kron<span class="org-rainbow-delimiters-depth-3">(</span>w'<span class="org-type">.*</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span>,<span class="org-rainbow-delimiters-depth-4">[</span><span class="org-highlight-numbers-number">0</span><span class="org-type">:</span>n<span class="org-type">-</span><span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">]</span><span class="org-type">*</span>h;
</pre>
</div>


<div id="orga8cfb90" class="figure">
<p><img src="figs/fir_filter_ligo.png" alt="fir_filter_ligo.png" />
</p>
<p><span class="figure-number">Figure 28: </span>FIR Complementary filters obtain after convex optimization (<a href="./figs/fir_filter_ligo.png">png</a>, <a href="./figs/fir_filter_ligo.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-org48a87c8" class="outline-3">
<h3 id="org48a87c8"><span class="section-number-3">7.3</span> Weights</h3>
<div class="outline-text-3" id="text-7-3">
<p>
We design weights that will be used for the \(\mathcal{H}_\infty\) synthesis of the complementary filters.
These weights will determine the order of the obtained filters.
Here are the requirements on the filters:
</p>
<ul class="org-ul">
<li>reasonable order</li>
<li>to be as close as possible to the specified upper bounds</li>
<li>stable minimum phase</li>
</ul>

<p>
The weights are shown below and their bode plot is shown on figure [[]]
</p>

<pre class="example">
wH

wH =

           0.32768 (s+0.3142) (s^2 + 0.3142s + 0.0987)^2 (s^2 + 0.05655s + 0.07994)
  -------------------------------------------------------------------------------------------
  (s+0.05027) (s^2 + 0.03519s + 0.002527) (s^2 + 0.2513s + 0.06317) (s^2 + 0.1131s + 0.07994)

Continuous-time zero/pole/gain model.
</pre>


<pre class="example">
wL

wL =

          22.222 s^20
  ---------------------------
  (s^2 + 0.7804s + 0.3198)^10

Continuous-time zero/pole/gain model.
</pre>


<div id="org865d51f" class="figure">
<p><img src="figs/ligo_weights.png" alt="ligo_weights.png" />
</p>
<p><span class="figure-number">Figure 29: </span>Weights for the \(\mathcal{H}_\infty\) synthesis (<a href="./figs/ligo_weights.png">png</a>, <a href="./figs/ligo_weights.pdf">pdf</a>)</p>
</div>
</div>
</div>


<div id="outline-container-org170666e" class="outline-3">
<h3 id="org170666e"><span class="section-number-3">7.4</span> H-Infinity Synthesis</h3>
<div class="outline-text-3" id="text-7-4">
<p>
We define the generalized plant as shown on figure <a href="#orge3f5b3d">16</a>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">P = <span class="org-rainbow-delimiters-depth-1">[</span><span class="org-highlight-numbers-number">0</span>   wL;
     wH <span class="org-type">-</span>wH;
     <span class="org-highlight-numbers-number">1</span>   <span class="org-highlight-numbers-number">0</span><span class="org-rainbow-delimiters-depth-1">]</span>;
</pre>
</div>

<p>
And we do the \(\mathcal{H}_\infty\) synthesis using the <code>hinfsyn</code> command.
</p>
<div class="org-src-container">
<pre class="src src-matlab"><span class="org-rainbow-delimiters-depth-1">[</span>Hl, <span class="org-type">~</span>, gamma, <span class="org-type">~</span><span class="org-rainbow-delimiters-depth-1">]</span> = hinfsyn<span class="org-rainbow-delimiters-depth-1">(</span>P, <span class="org-highlight-numbers-number">1</span>, <span class="org-highlight-numbers-number">1</span>,'TOLGAM', <span class="org-highlight-numbers-number">0</span>.<span class="org-highlight-numbers-number">001</span>, 'METHOD', 'ric', 'DISPLAY', 'on'<span class="org-rainbow-delimiters-depth-1">)</span>;
</pre>
</div>

<pre class="example">
[Hl, ~, gamma, ~] = hinfsyn(P, 1, 1,'TOLGAM', 0.001, 'METHOD', 'ric', 'DISPLAY', 'on');
Resetting value of Gamma min based on D_11, D_12, D_21 terms

Test bounds:      0.3276 &lt;  gamma  &lt;=      1.6807

  gamma    hamx_eig  xinf_eig  hamy_eig   yinf_eig   nrho_xy   p/f
    1.681   2.8e-02 -4.6e-19   1.8e-02   -2.8e-18    0.0000    p
    1.004   2.8e-02 -1.4e-18   1.8e-02   -6.6e-12    0.0000    p
    0.666   2.8e-02 -3.0e-01#  1.8e-02   -1.7e-11    0.0000    f
    0.835   2.8e-02 -1.3e+00#  1.8e-02   -1.3e-17    0.0000    f
    0.920   2.8e-02 -4.0e+00#  1.8e-02   -2.6e-18    0.0000    f
    0.962   2.8e-02 -1.7e+01#  1.8e-02   -4.2e-12    0.0000    f
    0.983   2.8e-02   9.0e-19   1.8e-02   -3.4e-11    0.0000    p
    0.972   2.8e-02 -6.5e+01#  1.8e-02   -8.7e-18    0.0000    f
    0.978   2.8e-02 -7.4e-18   1.8e-02   -1.3e-17    0.0000    p
    0.975   2.8e-02 -2.1e+02#  1.8e-02   -1.9e-11    0.0000    f
    0.976   2.8e-02 -3.9e-16   1.8e-02   -6.4e-18    0.0000    p
    0.976   2.8e-02 -4.4e+02#  1.8e-02    0.0e+00    0.0000    f

 Gamma value achieved:     0.9764
</pre>

<p>
The high pass filter is defined as \(H_H = 1 - H_L\).
</p>
<div class="org-src-container">
<pre class="src src-matlab">Hh = <span class="org-highlight-numbers-number">1</span> <span class="org-type">-</span> Hl;
</pre>
</div>

<p>
The size of the filters is shown below.
</p>

<pre class="example">
size(Hh), size(Hl)
State-space model with 1 outputs, 1 inputs, and 27 states.
State-space model with 1 outputs, 1 inputs, and 27 states.
</pre>

<p>
The bode plot of the obtained filters as shown on figure <a href="#org304f256">30</a>.
</p>


<div id="org304f256" class="figure">
<p><img src="figs/hinf_synthesis_ligo_results.png" alt="hinf_synthesis_ligo_results.png" />
</p>
<p><span class="figure-number">Figure 30: </span>Obtained complementary filters using the \(\mathcal{H}_\infty\) synthesis (<a href="./figs/hinf_synthesis_ligo_results.png">png</a>, <a href="./figs/hinf_synthesis_ligo_results.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-orgbe87287" class="outline-3">
<h3 id="orgbe87287"><span class="section-number-3">7.5</span> Compare FIR and H-Infinity Filters</h3>
<div class="outline-text-3" id="text-7-5">
<p>
Let's now compare the FIR filters designed in <a class='org-ref-reference' href="#hua05_low_ligo">hua05_low_ligo</a> and the one obtained with the \(\mathcal{H}_\infty\) synthesis on figure <a href="#org57b3d2d">31</a>.
</p>


<div id="org57b3d2d" class="figure">
<p><img src="figs/comp_fir_ligo_hinf.png" alt="comp_fir_ligo_hinf.png" />
</p>
<p><span class="figure-number">Figure 31: </span>Comparison between the FIR filters developped for LIGO and the \(\mathcal{H}_\infty\) complementary filters (<a href="./figs/comp_fir_ligo_hinf.png">png</a>, <a href="./figs/comp_fir_ligo_hinf.pdf">pdf</a>)</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org4e0fb2e" class="outline-2">
<h2 id="org4e0fb2e"><span class="section-number-2">8</span> Analytical Formula found in the literature</h2>
<div class="outline-text-2" id="text-8">
<p>
<a id="orgc408884"></a>
</p>
</div>

<div id="outline-container-org33f4875" class="outline-3">
<h3 id="org33f4875"><span class="section-number-3">8.1</span> Analytical Formula</h3>
<div class="outline-text-3" id="text-8-1">
<p>
<a class='org-ref-reference' href="#min15_compl_filter_desig_angle_estim">min15_compl_filter_desig_angle_estim</a>
</p>
\begin{align*}
  H_L(s) = \frac{K_p s + K_i}{s^2 + K_p s + K_i} \\
  H_H(s) = \frac{s^2}{s^2 + K_p s + K_i}
\end{align*}

<p>
<a class='org-ref-reference' href="#corke04_inert_visual_sensin_system_small_auton_helic">corke04_inert_visual_sensin_system_small_auton_helic</a>
</p>
\begin{align*}
  H_L(s) = \frac{1}{s/p + 1} \\
  H_H(s) = \frac{s/p}{s/p + 1}
\end{align*}

<p>
<a class='org-ref-reference' href="#jensen13_basic_uas">jensen13_basic_uas</a>
</p>
\begin{align*}
  H_L(s) = \frac{2 \omega_0 s + \omega_0^2}{(s + \omega_0)^2} \\
  H_H(s) = \frac{s^2}{(s + \omega_0)^2}
\end{align*}

\begin{align*}
  H_L(s) = \frac{C(s)}{C(s) + s} \\
  H_H(s) = \frac{s}{C(s) + s}
\end{align*}

<p>
<a class='org-ref-reference' href="#shaw90_bandw_enhan_posit_measur_using_measur_accel">shaw90_bandw_enhan_posit_measur_using_measur_accel</a>
</p>
\begin{align*}
  H_L(s) = \frac{3 \tau s + 1}{(\tau s + 1)^3} \\
  H_H(s) = \frac{\tau^3 s^3 + 3 \tau^2 s^2}{(\tau s + 1)^3}
\end{align*}

<p>
<a class='org-ref-reference' href="#baerveldt97_low_cost_low_weigh_attit">baerveldt97_low_cost_low_weigh_attit</a>
</p>
\begin{align*}
  H_L(s) = \frac{2 \tau s + 1}{(\tau s + 1)^2} \\
  H_H(s) = \frac{\tau^2 s^2}{(\tau s + 1)^2}
\end{align*}
</div>
</div>

<div id="outline-container-orge2e7efe" class="outline-3">
<h3 id="orge2e7efe"><span class="section-number-3">8.2</span> Matlab</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">
<pre class="src src-matlab">omega0 = <span class="org-highlight-numbers-number">1</span><span class="org-type">*</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span><span class="org-constant">pi</span>; <span class="org-comment">% [rad/s]</span>
tau = <span class="org-highlight-numbers-number">1</span><span class="org-type">/</span>omega0; <span class="org-comment">% [s]</span>

<span class="org-comment">% From cite:corke04_inert_visual_sensin_system_small_auton_helic</span>
HL1 = <span class="org-highlight-numbers-number">1</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">/</span>omega0 <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>; HH1 = s<span class="org-type">/</span>omega0<span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">/</span>omega0 <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span>;

<span class="org-comment">% From cite:jensen13_basic_uas</span>
HL2 = <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span>omega0<span class="org-type">*</span>s <span class="org-type">+</span> omega0<span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">+</span>omega0<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span>; HH2 = s<span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>s<span class="org-type">+</span>omega0<span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">2</span>;

<span class="org-comment">% From cite:shaw90_bandw_enhan_posit_measur_using_measur_accel</span>
HL3 = <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-highlight-numbers-number">3</span><span class="org-type">*</span>tau<span class="org-type">*</span>s <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>tau<span class="org-type">*</span>s <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">3</span>; HH3 = <span class="org-rainbow-delimiters-depth-1">(</span>tau<span class="org-type">^</span><span class="org-highlight-numbers-number">3</span><span class="org-type">*</span>s<span class="org-type">^</span><span class="org-highlight-numbers-number">3</span> <span class="org-type">+</span> <span class="org-highlight-numbers-number">3</span><span class="org-type">*</span>tau<span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-type">*</span>s<span class="org-type">^</span><span class="org-highlight-numbers-number">2</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">/</span><span class="org-rainbow-delimiters-depth-1">(</span>tau<span class="org-type">*</span>s <span class="org-type">+</span> <span class="org-highlight-numbers-number">1</span><span class="org-rainbow-delimiters-depth-1">)</span><span class="org-type">^</span><span class="org-highlight-numbers-number">3</span>;
</pre>
</div>


<div id="orgdcfc50d" class="figure">
<p><img src="figs/comp_filters_literature.png" alt="comp_filters_literature.png" />
</p>
<p><span class="figure-number">Figure 32: </span>Comparison of some complementary filters found in the literature (<a href="./figs/comp_filters_literature.png">png</a>, <a href="./figs/comp_filters_literature.pdf">pdf</a>)</p>
</div>
</div>
</div>

<div id="outline-container-orgf8d8c6a" class="outline-3">
<h3 id="orgf8d8c6a"><span class="section-number-3">8.3</span> Discussion</h3>
<div class="outline-text-3" id="text-8-3">
<p>
Analytical Formula found in the literature provides either no parameter for tuning the robustness / performance trade-off.
</p>
</div>
</div>
</div>

<div id="outline-container-org665e091" class="outline-2">
<h2 id="org665e091"><span class="section-number-2">9</span> Comparison of the different methods of synthesis</h2>
<div class="outline-text-2" id="text-9">
<p>
  <a id="org31b6972"></a>
The generated complementary filters using \(\mathcal{H}_\infty\) and the analytical formulas are very close to each other. However there is some difference to note here:
</p>
<ul class="org-ul">
<li>the analytical formula provides a very simple way to generate the complementary filters (and thus the controller), they could even be used to tune the controller online using the parameters \(\alpha\) and \(\omega_0\). However, these formula have the property that \(|H_H|\) and \(|H_L|\) are symmetrical with the frequency \(\omega_0\) which may not be desirable.</li>
<li>while the \(\mathcal{H}_\infty\) synthesis of the complementary filters is not as straightforward as using the analytical formula, it provides a more optimized procedure to obtain the complementary filters</li>
</ul>
</div>
</div>
<p>

<h1 class='org-ref-bib-h1'>Bibliography</h1>
<ul class='org-ref-bib'><li><a id="hua05_low_ligo">[hua05_low_ligo]</a> <a name="hua05_low_ligo"></a>@phdthesishua05_low_ligo,
  author =       Hua, Wensheng,
  school =       stanford university,
  title =        Low frequency vibration isolation and alignment system for
                  advanced LIGO,
  year =         2005,
</li>
<li><a id="min15_compl_filter_desig_angle_estim">[min15_compl_filter_desig_angle_estim]</a> <a name="min15_compl_filter_desig_angle_estim"></a>Min & Jeung, Complementary Filter Design for Angle Estimation Using Mems Accelerometer and Gyroscope, <i>Department of Control and Instrumentation, Changwon National University, Changwon, Korea</i>,  641-773 (2015).</li>
<li><a id="corke04_inert_visual_sensin_system_small_auton_helic">[corke04_inert_visual_sensin_system_small_auton_helic]</a> <a name="corke04_inert_visual_sensin_system_small_auton_helic"></a>Peter Corke, An Inertial and Visual Sensing System for a Small Autonomous Helicopter, <i>Journal of Robotic Systems</i>, <b>21(2)</b>, 43-51 (2004). <a href="https://doi.org/10.1002/rob.10127">link</a>. <a href="http://dx.doi.org/10.1002/rob.10127">doi</a>.</li>
<li><a id="jensen13_basic_uas">[jensen13_basic_uas]</a> <a name="jensen13_basic_uas"></a>Austin Jensen, Cal Coopmans & YangQuan Chen, Basics and guidelines of complementary filters for small UAS  navigation, nil, in in: 2013 International Conference on Unmanned Aircraft Systems
                  (ICUAS), edited by (2013)</li>
<li><a id="shaw90_bandw_enhan_posit_measur_using_measur_accel">[shaw90_bandw_enhan_posit_measur_using_measur_accel]</a> <a name="shaw90_bandw_enhan_posit_measur_using_measur_accel"></a>Shaw & Srinivasan, Bandwidth Enhancement of Position Measurements Using Measured  Acceleration, <i>Mechanical Systems and Signal Processing</i>, <b>4(1)</b>, 23-38 (1990). <a href="https://doi.org/10.1016/0888-3270(90)90038-m">link</a>. <a href="http://dx.doi.org/10.1016/0888-3270(90)90038-m">doi</a>.</li>
<li><a id="baerveldt97_low_cost_low_weigh_attit">[baerveldt97_low_cost_low_weigh_attit]</a> <a name="baerveldt97_low_cost_low_weigh_attit"></a>Baerveldt & Klang, A Low-Cost and Low-Weight Attitude Estimation System for an Autonomous Helicopter, nil, in in: Proceedings of IEEE International Conference on Intelligent Engineering Systems, edited by (1997)</li>
</ul>
</p>
</div>
<div id="postamble" class="status">
<p class="author">Author: Thomas Dehaeze</p>
<p class="date">Created: 2019-08-14 mer. 10:55</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
