% Created 2019-08-16 ven. 22:07
% Intended LaTeX compiler: pdflatex
\documentclass[9pt, technote, a4paper]{ieeeconf}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage[most]{tcolorbox}
\usepackage{siunitx}
\usepackage{amsmath,amssymb,amsfonts, cases}
\usepackage{algorithmic, graphicx, textcomp}
\usepackage{xcolor, import, hyperref}
\usepackage[USenglish, english]{babel}
\setcounter{footnote}{1}
\input{config.tex}
\author{\IEEEauthorblockN{Dehaeze Thomas\IEEEauthorrefmark{*}, Vermat Mohit and Collette Christophe} \\ \IEEEauthorblockA{Precision Mechatronics Laboratory, ULB\\ Brussels, Belgium\\ Email: \IEEEauthorrefmark{*}dehaeze.thomas@gmail.com}}
\date{2019-08-16}
\title{On the Design of Complementary Filters for Control}
\hypersetup{
 pdfauthor={\IEEEauthorblockN{Dehaeze Thomas\IEEEauthorrefmark{*}, Vermat Mohit and Collette Christophe} \\ \IEEEauthorblockA{Precision Mechatronics Laboratory, ULB\\ Brussels, Belgium\\ Email: \IEEEauthorrefmark{*}dehaeze.thomas@gmail.com}},
 pdftitle={On the Design of Complementary Filters for Control},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 26.2 (Org mode 9.2.5)},
 pdflang={English}}
\begin{document}

\maketitle
\bibliographystyle{IEEEtran}

\begin{abstract}
Abstract text to be done
\end{abstract}

\begin{IEEEkeywords}
complementary filters, h-infinity, feedback control
\end{IEEEkeywords}

\section{Introduction}
\label{sec:org1592c87}
  \label{sec:introduction}
The basic idea of a complementary filter involves taking two or more sensors, filtering out unreliable frequencies for each sensor and combining the filtered outputs to get a better estimate throughout the entire bandwidth of the system.
To achieve this, the sensors included in the filter should complement one another by performing better over specific parts of the system bandwidth.
A set of filters is said to be complementary if the sum of their transfer functions is equal to one at all frequencies, (i.e.) its magnitude is one and its phase is zero.

The proper design of this particular kind of filter is of primary importance in a wide range of applications.
Often, multiple sensors with different noise or dynamical properties are used to measure the same physical quantity.
In such case, complementary filters can be used to merge the sensors and forms a "super sensor" that has gives a better estimate of the physical quantity over a wider bandwidth.
This is called sensor blending or sensor fusion.

This is widely used for the attitude estimation of unmanned aerial vehicles using various kind of sensors (accelerometers, gyroscopes, vision sensors, inclinometer) \cite{zimmermann92_high_bandw_orien_measur_contr,corke04_inert_visual_sensin_system_small_auton_helic,min15_compl_filter_desig_angle_estim}.

\cite{shaw90_bandw_enhan_posit_measur_using_measur_accel} Fast position measurement of flexible structure

\cite{matichard15_seism_isolat_advan_ligo} (relative displacement measurement at low frequencies with inertial at high frequencies)

\cite{hua04_polyp_fir_compl_filter_contr_system}

\cite{collette15_sensor_fusion_method_high_perfor}
The design methods for such filters goes from simple analytical formulas

\cite{corke04_inert_visual_sensin_system_small_auton_helic}

\cite{min15_compl_filter_desig_angle_estim}
\cite{jensen13_basic_uas}

\cite{shaw90_bandw_enhan_posit_measur_using_measur_accel}
\cite{zimmermann92_high_bandw_orien_measur_contr}
\cite{matichard15_seism_isolat_advan_ligo}
\cite{collette15_sensor_fusion_method_high_perfor}

\cite{hua05_low_ligo}
\cite{hua04_polyp_fir_compl_filter_contr_system}
\cite{matichard15_seism_isolat_advan_ligo}

\cite{mahony08_nonlin_compl_filter_special_orthog_group}

\cite{pascoal99_navig_system_desig_using_time}

\cite{jensen13_basic_uas} (feedback system, P, PI, classical control theory for filter design)
\cite{brown72_integ_navig_system_kalman_filter}

\cite{pascoal99_navig_system_desig_using_time}

\cite{min15_compl_filter_desig_angle_estim}
Although
In this paper, we propose
The body of the paper consists of five parts followed by a conclusion.

\section{Requirements on the Design of Complementary Filters}
\label{sec:org045537e}
\label{sec:requirements}

\subsection{Sensor Fusion}
\label{sec:org68eba14}

Let's consider two sensors measuring the physical quantity \(x\) with dynamics \(G_1(s)\) and \(G_2(s)\) and with noise \(n_1\) and \(n_2\) respectively.


\(H_1(s)\) and \(H_2(s)\) are complementary filters:
\begin{equation}
  H_1(s) + H_2(s) = 1
\end{equation}

\begin{equation}
  \hat{x} = \left(G_1 H_1 + G_2 H_2\right) x + H_1 n_1 + H_2 n_2
\end{equation}

If we now consider sensors with perfect dynamics (\(G_1(s) = G_2(s) = 1\)), we have that the estimate of \(x\) using the two sensors are shown on figure \ref{fig:fusion_two_noisy_sensors_with_dyn_ter} is:

\begin{equation}
  \hat{x} = x + H_1 n_1 + H_2 n_2
\end{equation}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/fusion_two_noisy_sensors_with_dyn_ter.pdf}
\caption{\label{fig:fusion_two_noisy_sensors_with_dyn_ter}
Sensor Fusion Architecture}
\end{figure}

We see that the complementary filters \(H_1(s)\) and \(H_2(s)\) operates only on the noise of the sensors.

Thus, this architecture permits to filter each of the sensors without introducing any distortion in the physical quantity to measure.

\begin{equation}
  \delta x = \hat{x} - x = H_1 n_1 + H_2 n_2
\end{equation}

Usually, the two sensors have higher noise levels over distinct yet complementary frequency regions. The two complementary filters are used to combine the filtered noise and yield to a better estimate \(\hat{x}\) over a larger bandwidth.

The noise of the super sensor is determine by the norm of the complementary filters.

\subsection{Noise Sensor Filtering}
\label{sec:orgce86efa}


\subsection{Robustness of the Fusion}
\label{sec:orgc52988d}


\subsection{Upper bounds as a mathematical translation of the requirements}
\label{sec:org4ab877a}
\begin{quote}
The conclusion of the section should be that it is the norm of the complementary filter that is important and that is why we propose a method of synthesis based on H-infinity
\end{quote}

\section{Shaping of Complementary Filters using the \(\mathcal{H}_\infty\) Synthesis}
\label{sec:org4728e0e}
\label{sec:hinf_method}
First order complementary filters are easy to synthesize. For instance, one can use the following filters
\begin{equation}
H_H(s) = \frac{s/\w_0}{1 + s/\w_0}; \quad H_L(s) = \frac{1}{1 + s/\w_0}
\end{equation}
with \(\w_0\) is the tuning parameter corresponding to the crossover frequency of the filters.

However, the manual design of higher order complementary filters is far more complex and we have to use an automatic synthesis technique.

As shown in Sec. \ldots{}, most of the performance requirements can be expressed as upper bounds on the magnitude of the complementary filters.

Thus, the \(\mathcal{H}_\infty\) framework seems adapted and we here propose a technique to synthesis complementary filters while specifying uppers bounds on their magnitudes.

\subsection{\(\mathcal{H}_\infty\) problem formulation}
\label{sec:orgdd7b8f5}
   \label{sec:hinf_conf}
In this section, we formulate the \(\hinf\) problem for the synthesis of complementary filters.

The synthesis objective is to shape an high pass filter \(H_H\) and a low pass filter \(H_L\) while ensuring their complementary property (\(H_H + H_L = 1\)).

To do so, we define two weighting functions \(w_L\) and \(w_H\) that will respectively used to shape \(H_L\) and \(H_H\).

The synthesis problem is then
\begin{subnumcases}{\text{Find } H_L, H_H \text{ such that}}
  H_L \text{ and } H_H \text{ are stable} \label{eq:hinf_cond_stability}\\
  H_L + H_H = 1 \label{eq:hinf_cond_complementarity} \\
  |w_L H_L| \le 1 \quad \forall\omega \label{eq:hinf_cond_hl} \\
  |w_H H_H| \le 1 \quad \forall\omega \label{eq:hinf_cond_hh}
\end{subnumcases}


To express this synthesis problem into an \(\hinf\) synthesis problem, we define the following generalized plant \(P\) (also shown on Fig. \ref{fig:sf_hinf_filters_plant_b}):
\begin{equation}
\label{eq:generalized_plant}
  \colvec{w\\u} = P \colvec{z_H \\ z_L \\ v}; \quad P = \begin{bmatrix} w_H & -w_H \\ 0 & w_L \\ 1 & 0 \end{bmatrix}
\end{equation}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/h_infinity_robust_fusion.pdf}
\caption{\label{fig:h_infinity_robust_fusion}
Architecture used for the \(\mathcal{H}_\infty\) synthesis of complementary filters}
\end{figure}

The \(\hinf\) synthesis objective is then to design a stable filter \(H_L\) (Fig. \ref{fig:sf_hinf_filters_b}) such that the \(\mathcal{H}_\infty\) norm of the transfer function from \(w\) to \([z_H, \ z_L]\) is less than \(1\):
\begin{equation}
  \hnorm{\begin{matrix} (1 - H_L) w_H \\ H_L w_L \end{matrix}} \le 1
\end{equation}
Which is equivalent to
\begin{equation}
\label{eq:hinf_problem}
  \hnorm{\begin{matrix} H_H w_H \\ H_L w_L \end{matrix}} < 1 \text{ by choosing } H_H = 1 - H_L
\end{equation}

Performance conditions \eqref{eq:hinf_cond_hl} and \eqref{eq:hinf_cond_hl} are satisfied by \eqref{eq:hinf_problem}.
Complementary condition \eqref{eq:hinf_cond_complementarity} is satisfied by design: \(H_H = 1 - H_L\) and thus \(H_L + H_H = 1\).
The stability condition \eqref{eq:hinf_cond_stability} is guaranteed by the \(H_\infty\) synthesis (\textbf{reference}).


Using this synthesis method, we are then able to shape at the same time the high pass and low pass filters while ensuring their complementary.

\subsection{Control requirements as \(\mathcal{H}_\infty\) norm of complementary filters}
\label{sec:org8724b71}
As presented in Sec. \ref{sec:trans_perf}, almost all the requirements can be specified with upper bounds on the complementary filters.
However, robust performance condition \eqref{eq:robust_perf_a} is not.

With the \(\mathcal{H}_\infty\) synthesis the condition \eqref{eq:hinf_problem} only ensure
\begin{align*}
  \hnorm{\begin{matrix} H_H w_H \\ H_L w_L \end{matrix}} \le 1 &\Leftrightarrow \max_\omega \sqrt{|w_L H_L|^2 + |w_H H_H|^2} \le 1\\
                                                             &\Rightarrow |w_L H_L| + |w_H H_H| \le \sqrt{2} \quad \forall\omega
\end{align*}

And thus we have almost robust stability.

\subsection{Choice of the weighting functions}
\label{sec:org04e66eb}
   \label{sec:hinf_weighting_func}
We here give some advice on the choice of the weighting functions used for the synthesis of the complementary filters.

The shape should be such that the performance requirements are met as explain in Sec. \ref{sec:trans_perf}.

However, one should be careful when designing the complementary filters, and should only use stable and minimum phase transfer functions.
The order of the weights should stay reasonably small as this will increase the complexity of the optimization problem.

One should not forget the fundamental limitations of feedback control such that \(S + T = 1\).
Similarly, we here have that \(H_L + H_H = 1\) which implies that \(H_L\) and \(H_H\) cannot be made small at the same time.

\begin{equation}
  W(s) = G_c * \left(\frac{\frac{1}{\omega_0}\sqrt{\frac{1 - \left(\frac{G_0}{G_c}\right)^{\frac{2}{n}}}{1 - \left(\frac{G_c}{G_\infty}\right)^{\frac{2}{n}}}} s + \left(\frac{G_0}{G_c}\right)^{\frac{1}{n}}}{\frac{1}{\omega_0} \sqrt{\frac{1 - \left(\frac{G_0}{G_c}\right)^{\frac{2}{n}}}{\left(\frac{G_\infty}{G_c}\right)^{\frac{2}{n}} - 1}} s + 1}\right)^n
\end{equation}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/weight_formula.pdf}
\caption{\label{fig:weight_formula}
Amplitude of the proposed formula for the weighting functions}
\end{figure}

\subsection{Example}
\label{sec:orgf8bbd7b}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/weights_wl_wh.pdf}
\caption{\label{fig:weights_wl_wh}
Weighting Functions used for the \(\mathcal{H}_\infty\) Synthesis}
\end{figure}


\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/hinf_synthesis_results.pdf}
\caption{\label{fig:hinf_synthesis_results}
Obtain Complementary Filters}
\end{figure}

\subsection{Synthesis of Three Complementary Filters}
\label{sec:org916d6f2}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/comp_filter_three_hinf.pdf}
\caption{\label{fig:comp_filter_three_hinf}
Architecture for the \(\mathcal{H}_\infty\) synthesis of three complementary filters}
\end{figure}

\section{Application to the design of}
\label{sec:org7e3fe3e}
\label{sec:application}

\subsection{Specifications}
\label{sec:org7f6a128}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/ligo_specifications.pdf}
\caption{\label{fig:ligo_specifications}
Specifications on the norms of the complementary filters}
\end{figure}

\subsection{Weighting functions design}
\label{sec:orgdd7b46d}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/ligo_weights.pdf}
\caption{\label{fig:ligo_weights}
Weighting Functions used for the \(\mathcal{H}_\infty\) synthesis}
\end{figure}

\subsection{Comparison}
\label{sec:orge13017e}

\begin{figure}[htbp]
\centering
\includegraphics[scale=1]{figs/comp_fir_ligo_hinf.pdf}
\caption{\label{fig:comp_fir_ligo_hinf}
Comparison of the filters obtain with the \(\mathcal{H}_\infty\) synthesis and the FIR filters designed in \cite{hua05_low_ligo}}
\end{figure}

\section{Conclusion}
\label{sec:org7a21636}
\label{sec:conclusion}

\section{Acknowledgment}
\label{sec:org56fbb7d}

\bibliography{ref}
\end{document}